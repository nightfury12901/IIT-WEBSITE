<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publications | Dr. Abhishek Dixit</title>
    <link rel="stylesheet" href="styles6.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="interactive-bg"></canvas>
    <div id="gradient-spot"></div>
    <div class="iit-logo-bg"></div>
    
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">Dr. Abhishek Dixit</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="research.html" class="nav-link">Research</a></li>
                <li><a href="publications.html" class="nav-link active">Publications</a></li>
                <li><a href="projects.html" class="nav-link">Projects</a></li>
                <li><a href="team.html" class="nav-link">Team</a></li>
                <li><a href="awards.html" class="nav-link">Awards</a></li>
                <li><a href="gallery.html" class="nav-link">Gallery</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>Publications</h1>
                <p id="publications-subtitle">Complete list of research publications and scholarly work</p>
            </div>
        </section>

        <section class="publications-section">
            <div class="container">
                <!-- Loading indicator -->
                <div id="loading-indicator" class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">
                        <p>Loading publications...</p>
                        <p class="loading-subtext">Please wait while we fetch the latest publications</p>
                        <div class="loading-progress">
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Scholar Profile Header -->
                <div id="scholar-profile" class="scholar-profile-header gallery-image" style="display: none;">
                    <div class="profile-info">
                        <h2 id="scholar-name">Dr. Abhishek Dixit</h2>
                        <p id="scholar-affiliation">Indian Institute of Technology Delhi</p>
                        <div class="profile-meta">
                            <span id="data-source" class="data-source">Research Publications</span>
                            <span id="response-time" class="response-time"></span>
                            <span id="backend-status" class="backend-status">Updated</span>
                        </div>
                        <a id="scholar-link" href="https://scholar.google.co.in/citations?user=CjJ84BwAAAAJ&hl=en" target="_blank" class="btn btn-primary">
                            View Complete Google Scholar Profile
                        </a>
                    </div>
                    <div class="scholar-metrics">
                        <div class="metric-item">
                            <span id="total-pubs" class="metric-number">0</span>
                            <span class="metric-label">Publications</span>
                        </div>
                        <div class="metric-item">
                            <span id="total-citations" class="metric-number">0</span>
                            <span class="metric-label">Citations</span>
                        </div>
                        <div class="metric-item">
                            <span id="h-index" class="metric-number">0</span>
                            <span class="metric-label">h-index</span>
                        </div>
                        <div class="metric-item">
                            <span id="i10-index" class="metric-number">0</span>
                            <span class="metric-label">i10-index</span>
                        </div>
                    </div>
                </div>

                <!-- Action buttons -->
                <div id="action-buttons" class="action-buttons" style="display: none;">
                    <button id="refresh-btn" class="btn btn-secondary">
                        üîÑ Refresh Publications
                    </button>
                    <button id="search-btn" class="btn btn-info" onclick="toggleSearch()">
                        üîç Search Publications
                    </button>
                </div>

                <!-- Search Section -->
                <div id="search-section" class="search-section" style="display: none;">
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="Search publications by title, authors, or venue..." class="search-input">
                        <button onclick="searchPublications()" class="btn btn-primary">Search</button>
                        <button onclick="clearSearch()" class="btn btn-outline">Clear</button>
                    </div>
                </div>

                <h2 class="section-title">Publications by Year</h2>
                
                <div class="publication-filters gallery-image" id="year-filters" style="display: none;">
                    <button class="filter-btn active" data-filter="all">All Years</button>
                </div>

                <div id="publications-container" class="publications-list">
                    <!-- Publications will be dynamically loaded here -->
                </div>

                <div id="last-updated" class="last-updated-info" style="display: none;">
                    <p>Last updated: <span id="update-time"></span></p>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Dr. Abhishek Dixit. All rights reserved.</p>
        </div>
    </footer>

    <script src="back.js"></script>
    
    <!-- Embedded Publications JavaScript -->
    <script>
        class ScholarPublications {
            constructor() {
                this.publications = [];
                this.scholarData = null;
                this.apiBaseUrl = '/api';
                this.currentPage = 1;
                this.totalPages = 0;
                this.isLoading = false;
                this.totalPublications = 0;
                this.currentFilter = 'all';
                this.searchQuery = '';
                this.init();
            }

            async init() {
                try {
                    this.setupActionButtons();
                    await this.loadPublications();
                } catch (error) {
                    console.error('Error initializing publications:', error);
                    this.showError(error);
                }
            }

            setupActionButtons() {
                const refreshBtn = document.getElementById('refresh-btn');

                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => this.refreshData());
                }

                // Setup search input
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.searchPublications();
                        }
                    });
                }
            }

            async loadPublications(page = 1) {
                if (this.isLoading) return;
                
                this.isLoading = true;
                this.showLoading();
                
                try {
                    const startTime = Date.now();
                    let url = `${this.apiBaseUrl}/publications?page=${page}&per_page=5`;
                    
                    if (this.currentFilter !== 'all') {
                        url += `&year=${this.currentFilter}`;
                    }
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || `HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const responseTime = Date.now() - startTime;
                    
                    // Update profile on first load
                    if (data.profile && page === 1) {
                        this.updateProfileHeader(data.profile, {
                            responseTime: data.response_time,
                            source: data.source
                        });
                        this.totalPublications = data.profile.total_publications;
                        this.updateLastUpdated(data.last_updated);
                    }
                    
                    // Replace publications for new page/filter
                    this.publications = data.publications;
                    
                    // Update pagination
                    this.currentPage = data.pagination.page;
                    this.totalPages = data.pagination.total_pages;
                    
                    this.hideLoading();
                    this.renderPublications(data.publications, data.pagination);
                    
                    if (page === 1 && !this.searchQuery) {
                        await this.loadYearFilters();
                    }
                    
                } catch (error) {
                    console.error('Error loading publications:', error);
                    this.hideLoading();
                    this.showError(error);
                } finally {
                    this.isLoading = false;
                }
            }

            async loadYearFilters() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/years`);
                    const yearCounts = await response.json();
                    
                    this.setupFilters(yearCounts);
                    
                } catch (error) {
                    console.warn('Could not load year filters:', error);
                }
            }

            updateProfileHeader(profile, metadata = {}) {
                const elements = {
                    'scholar-name': profile.name || 'Dr. Abhishek Dixit',
                    'scholar-affiliation': profile.affiliation || '',
                    'total-pubs': profile.total_publications || 0,
                    'total-citations': profile.total_citations || 0,
                    'h-index': profile.h_index || 0,
                    'i10-index': profile.i10_index || 0
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                });

                const scholarLink = document.getElementById('scholar-link');
                if (scholarLink && profile.scholar_url) {
                    scholarLink.href = profile.scholar_url;
                }
                
                // Update metadata with user-friendly text
                const dataSource = document.getElementById('data-source');
                const responseTime = document.getElementById('response-time');
                
                if (dataSource) {
                    dataSource.textContent = 'üìö Research Publications';
                    dataSource.className = 'data-source research';
                }
                
                if (responseTime && metadata.responseTime) {
                    responseTime.textContent = `${metadata.responseTime}ms`;
                }
                
                const profileSection = document.getElementById('scholar-profile');
                const actionButtons = document.getElementById('action-buttons');
                if (profileSection) profileSection.style.display = 'block';
                if (actionButtons) actionButtons.style.display = 'flex';
            }

            updateLastUpdated(timestamp) {
                if (!timestamp) return;
                
                const date = new Date(timestamp);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const updateTime = document.getElementById('update-time');
                const lastUpdated = document.getElementById('last-updated');
                
                if (updateTime) updateTime.textContent = formattedDate;
                if (lastUpdated) lastUpdated.style.display = 'block';
            }

            renderPublications(publications, pagination) {
                const container = document.getElementById('publications-container');
                if (!container) return;
                
                // Clear container for new page/filter
                container.innerHTML = `
                    <div class="publications-info">
                        <h3>üìö Research Publications</h3>
                        <p>Page ${pagination.page} of ${pagination.total_pages} ‚Ä¢ ${pagination.total} total publications</p>
                        ${this.searchQuery ? `<p class="search-info">Search results for: "${this.searchQuery}"</p>` : ''}
                    </div>
                    <div class="publications-section"></div>
                `;
                
                const publicationsSection = container.querySelector('.publications-section');
                
                if (publications.length === 0) {
                    publicationsSection.innerHTML = '<p class="no-publications">No publications found for the selected criteria.</p>';
                    return;
                }
                
                // Render publications with animations
                publications.forEach((pub, index) => {
                    setTimeout(() => {
                        const pubItem = this.createPublicationItem(pub);
                        pubItem.style.opacity = '0';
                        pubItem.style.transform = 'translateY(20px)';
                        
                        publicationsSection.appendChild(pubItem);
                        
                        setTimeout(() => {
                            pubItem.style.transition = 'all 0.3s ease';
                            pubItem.style.opacity = '1';
                            pubItem.style.transform = 'translateY(0)';
                        }, 50);
                        
                    }, index * 100);
                });
                
                // Add pagination controls
                this.setupPagination(pagination);
            }

            createPublicationItem(pub) {
                const pubDiv = document.createElement('div');
                pubDiv.className = 'publication-item gallery-image';

                const title = pub.title || 'Unknown Title';
                const authors = pub.authors || 'Unknown Authors';
                const venue = pub.venue || 'Unknown Venue';
                const citations = pub.citations || 0;
                const year = pub.year || 'Unknown';
                const scholarUrl = pub.scholar_url || '';

                pubDiv.innerHTML = `
                    <div class="publication-number">[${pub.pub_number || pub.id}]</div>
                    <div class="publication-content">
                        <h4>${scholarUrl ? `<a href="${scholarUrl}" target="_blank">${title}</a>` : title}</h4>
                        <p class="authors">${authors}</p>
                        <p class="journal">${venue}</p>
                        <div class="publication-meta">
                            <span class="citation-count">Citations: ${citations}</span>
                        </div>
                        <div class="publication-links">
                            ${scholarUrl ? `<a href="${scholarUrl}" target="_blank" class="pub-link">Google Scholar</a>` : ''}
                        </div>
                    </div>
                `;

                return pubDiv;
            }

            setupPagination(pagination) {
                const container = document.getElementById('publications-container');
                if (!container || pagination.total_pages <= 1) return;

                const paginationDiv = document.createElement('div');
                paginationDiv.className = 'pagination-controls';
                
                // Previous button
                if (pagination.page > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'pagination-btn prev-btn';
                    prevBtn.innerHTML = '‚Üê Previous';
                    prevBtn.addEventListener('click', () => this.loadPublications(pagination.page - 1));
                    paginationDiv.appendChild(prevBtn);
                }
                
                // Page numbers (show current page and neighbors)
                const startPage = Math.max(1, pagination.page - 2);
                const endPage = Math.min(pagination.total_pages, pagination.page + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `pagination-btn page-number ${i === pagination.page ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => this.loadPublications(i));
                    paginationDiv.appendChild(pageBtn);
                }
                
                // Next button
                if (pagination.has_next) {
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'pagination-btn next-btn';
                    nextBtn.innerHTML = 'Next ‚Üí';
                    nextBtn.addEventListener('click', () => this.loadPublications(pagination.page + 1));
                    paginationDiv.appendChild(nextBtn);
                }
                
                container.appendChild(paginationDiv);
            }

            setupFilters(yearCounts) {
                const filtersContainer = document.getElementById('year-filters');
                if (!filtersContainer) return;
                
                // Create filter buttons for all years
                filtersContainer.innerHTML = '';
                const allYearsBtn = document.createElement('button');
                allYearsBtn.className = 'filter-btn';
                allYearsBtn.setAttribute('data-filter', 'all');
                allYearsBtn.textContent = 'All Years';
                if (this.currentFilter === 'all') allYearsBtn.classList.add('active');
                allYearsBtn.addEventListener('click', () => this.filterByYear('all'));
                filtersContainer.appendChild(allYearsBtn);

                // Sort years descending
                const sortedYears = Object.keys(yearCounts).sort((a, b) => {
                    if (a === 'Unknown' || b === 'Unknown') return a === 'Unknown' ? 1 : -1;
                    return parseInt(b) - parseInt(a);
                });

                sortedYears.forEach(year => {
                    const filterBtn = document.createElement('button');
                    filterBtn.className = 'filter-btn';
                    filterBtn.setAttribute('data-filter', year);
                    filterBtn.textContent = `${year} (${yearCounts[year]})`;
                    if (this.currentFilter === year) filterBtn.classList.add('active');
                    filterBtn.addEventListener('click', () => this.filterByYear(year));
                    filtersContainer.appendChild(filterBtn);
                });

                filtersContainer.style.display = 'flex';
            }

            filterByYear(year) {
                this.currentFilter = year;
                this.currentPage = 1;
                this.searchQuery = '';
                
                // Update active button
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                const activeBtn = document.querySelector(`[data-filter="${year}"]`);
                if (activeBtn) activeBtn.classList.add('active');
                
                // Hide search section
                const searchSection = document.getElementById('search-section');
                if (searchSection) searchSection.style.display = 'none';
                
                // Reload publications with filter
                this.loadPublications(1);
            }

            async searchPublications() {
                const searchInput = document.getElementById('search-input');
                const query = searchInput.value.trim();
                
                if (!query) {
                    alert('Please enter a search term');
                    return;
                }
                
                this.searchQuery = query;
                this.currentFilter = 'all';
                this.currentPage = 1;
                
                try {
                    this.showLoading();
                    
                    const response = await fetch(`${this.apiBaseUrl}/search?q=${encodeURIComponent(query)}&page=1&per_page=20`);
                    const data = await response.json();
                    
                    this.hideLoading();
                    
                    if (data.publications) {
                        this.renderSearchResults(data.publications, data.query);
                    } else {
                        this.showError(new Error('Search failed'));
                    }
                    
                } catch (error) {
                    this.hideLoading();
                    this.showError(error);
                }
            }

            renderSearchResults(publications, query) {
                const container = document.getElementById('publications-container');
                if (!container) return;
                
                container.innerHTML = `
                    <div class="search-results-info">
                        <h3>üîç Search Results</h3>
                        <p>Found ${publications.length} publications for "${query}"</p>
                        <button onclick="scholarPubs.clearSearch()" class="btn btn-outline">Clear Search</button>
                    </div>
                    <div class="publications-section"></div>
                `;
                
                const publicationsSection = container.querySelector('.publications-section');
                
                if (publications.length === 0) {
                    publicationsSection.innerHTML = '<p class="no-publications">No publications found for your search.</p>';
                    return;
                }
                
                publications.forEach((pub, index) => {
                    setTimeout(() => {
                        const pubItem = this.createPublicationItem(pub);
                        pubItem.style.opacity = '0';
                        pubItem.style.transform = 'translateY(20px)';
                        
                        publicationsSection.appendChild(pubItem);
                        
                        setTimeout(() => {
                            pubItem.style.transition = 'all 0.3s ease';
                            pubItem.style.opacity = '1';
                            pubItem.style.transform = 'translateY(0)';
                        }, 50);
                        
                    }, index * 100);
                });
            }

            clearSearch() {
                this.searchQuery = '';
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.value = '';
                }
                
                document.getElementById('search-section').style.display = 'none';
                this.loadPublications(1);
            }

            async refreshData() {
                this.currentPage = 1;
                this.searchQuery = '';
                await this.loadPublications(1);
            }

            showLoading() {
                const indicator = document.getElementById('loading-indicator');
                if (indicator) {
                    indicator.style.display = 'block';
                }
            }

            hideLoading() {
                const indicator = document.getElementById('loading-indicator');
                if (indicator) {
                    indicator.style.display = 'none';
                }
            }

            showError(error) {
                const container = document.getElementById('publications-container');
                if (container) {
                    container.innerHTML = `
                        <div class="error-message">
                            <h3>‚ö†Ô∏è Unable to load publications</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                            <div class="error-actions">
                                <button onclick="location.reload()" class="btn btn-primary">Try Again</button>
                            </div>
                        </div>
                    `;
                }
                this.hideLoading();
            }
        }

        // Global functions
        let scholarPubs;

        function toggleSearch() {
            const searchSection = document.getElementById('search-section');
            if (searchSection.style.display === 'none' || !searchSection.style.display) {
                searchSection.style.display = 'block';
                document.getElementById('search-input').focus();
            } else {
                searchSection.style.display = 'none';
            }
        }

        function searchPublications() {
            if (scholarPubs) {
                scholarPubs.searchPublications();
            }
        }

        function clearSearch() {
            if (scholarPubs) {
                scholarPubs.clearSearch();
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            scholarPubs = new ScholarPublications();
        });
    </script>
</body>
</html>

